# AGENTS.md

This document provides essential information for AI coding agents working with this codebase.

## Project Overview

**Patrick Erichsen's Personal Blog** - Built with the MultiTerm Astro theme, a blog theme designed for developers who love customizable color schemes. The site is statically generated using Astro and features GitHub-powered comments, activity calendars, and extensive markdown support.

## Tech Stack

- **Framework**: [Astro](https://astro.build/) v5.11.1 (Static Site Generation)
- **Styling**: [Tailwind CSS](https://tailwindcss.com/) v4.1.11
- **Content**: MDX with extensive markdown plugins
- **Code Highlighting**: Expressive Code with Shiki themes
- **Search**: Pagefind for static search
- **Package Manager**: npm

## Quick Commands

```bash
# Development
npm run dev              # Start dev server at http://localhost:4321

# Building
npm run build            # Build site (outputs to dist/)
npm run postbuild        # Runs automatically after build (generates Pagefind search index)

# Preview
npm run preview          # Preview production build locally

# Formatting
npm run format           # Format code with Prettier
```

## Project Structure

```
src/
├── components/          # Astro components
├── content/            # Content collections (posts, pages)
│   ├── posts/          # Blog posts (markdown/mdx)
│   ├── home.md         # Homepage content
│   └── addendum.md     # Footer addendum content
├── layouts/            # Page layouts
├── pages/              # Route pages and API endpoints
├── plugins/            # Custom remark/rehype plugins
├── styles/             # Global CSS
├── site.config.ts      # Main site configuration
└── utils.ts            # Utility functions
```

## Configuration

**Primary Config File**: `src/site.config.ts`

This single file controls all major site settings:
- Site metadata (title, description, author)
- Theme configuration (single/multiple/light-dark-auto modes)
- Social links
- Pagination settings
- Giscus comments configuration

## Content Management

### Adding Blog Posts

1. Create a new `.md` or `.mdx` file in `src/content/posts/`
2. Include frontmatter with required fields:
   - `title`: Post title
   - `description`: Post description (used in SEO)
   - `date`: Publication date (YYYY-MM-DD)
   - `tags`: Array of tags (optional)
   - `draft`: Boolean (optional, excludes from production if true)

### Markdown Features

The site supports extensive markdown extensions:
- **Admonitions**: Use `:::note`, `:::tip`, `:::warning`, etc.
- **Math**: KaTeX for LaTeX math expressions
- **Emoji**: Shortcode support via gemoji (e.g., `:smile:`)
- **GitHub Cards**: Special syntax for embedding GitHub repo cards
- **Table of Contents**: Auto-generated from headings
- **Code Blocks**: Enhanced with line numbers and syntax highlighting

## Custom Plugins

Located in `src/plugins/`:
- `remark-admonitions.ts`: Adds styled callout boxes
- `remark-gemoji.ts`: Emoji shortcode support
- `remark-github-card.ts`: GitHub repository embedding
- `rehype-pixelated.ts`: Custom image rendering

## Changelog Management

This project uses [git-cliff](https://git-cliff.org/) for automated changelog generation.

**Config**: `cliff.toml`

**Commit Conventions**: Follows [Conventional Commits](https://www.conventionalcommits.org)
- `feat:` → Features
- `fix:` → Bug Fixes
- `docs:` → Documentation
- `refactor:` → Refactor
- `style:` → Styling
- `test:` → Testing
- `chore:` → Miscellaneous Tasks

**Manual Changelog Updates**: When updating `CHANGELOG.md` manually:
1. Add entries under `## [Unreleased]` section
2. Use conventional commit format for consistency
3. Link PRs using markdown: `([#PR_NUMBER](URL))`

## Code Style

- **Formatter**: Prettier (config in `prettier.config.js`)
- **Style**: Follows Prettier defaults with Astro plugin
- **Before Committing**: Run `npm run format`

## Build Process

1. **Astro Build** (`npm run build`): Generates static site in `dist/`
2. **Postbuild** (automatic): Runs Pagefind to generate search index
3. **Output**: Fully static HTML/CSS/JS in `dist/` directory

## Theme System

The site uses Shiki themes for consistent color schemes across all elements:
- Configured in `src/site.config.ts` under `themes`
- Three modes available:
  - `single`: One theme for everything
  - `light-dark-auto`: Light/dark theme pair with auto-detection
  - `select`: Multiple themes with user selection
- CSS variables in `src/styles/global.css` map theme colors to site elements

## SEO & Social Cards

- **Social Cards**: Auto-generated using Satori at `/social-cards/[slug].png.ts`
- **RSS Feed**: Generated at `/rss.xml.ts`
- **Sitemap**: Auto-generated by Astro sitemap integration
- **Robots.txt**: Generated at `/robots.txt.ts`

## Testing

No automated tests are currently configured. Manual testing workflow:
1. Run `npm run dev` and verify changes locally
2. Run `npm run build` to ensure build succeeds
3. Run `npm run preview` to test production build

## Common Tasks for Agents

### Adding a New Dependency
```bash
npm install <package-name>
# Update CHANGELOG.md if it's a user-facing change
```

### Updating Dependencies
```bash
npm update <package-name>
# Document in CHANGELOG.md under [Unreleased] → Changed section
```

### Adding a New Page
1. Create file in `src/pages/` or `src/content/`
2. Use `Layout.astro` or `MarkdownLayout.astro` as needed
3. Update navigation links in `src/site.config.ts` if needed

### Modifying Theme Colors
- Edit theme selection in `src/site.config.ts`
- Modify CSS variable mappings in `src/styles/global.css`
- Regenerate Giscus theme files in `src/pages/giscus/`

## Deployment

The site uses GitHub Actions for deployment (`.github/workflows/astro.yml`):
- Triggers on push to main branch
- Builds site with npm
- Deploys to GitHub Pages

## Important Notes

- **Content Collections**: Defined in `src/content.config.ts`
- **Image Optimization**: Uses Astro's built-in image optimization
- **Social Card Avatar**: Must be square JPEG (configured in site.config.ts)
- **Font**: JetBrains Mono Variable (imported in `src/styles/global.css`)

## Resources

- [Astro Documentation](https://docs.astro.build/)
- [MultiTerm Theme Docs](https://github.com/stelcodes/multiterm-astro)
- [Expressive Code Themes](https://expressive-code.com/guides/themes/)
- [Giscus Setup](https://giscus.app/)
