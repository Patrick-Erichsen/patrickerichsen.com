---
import '/src/styles/global.css'
import Header from '@components/Header.astro'
import Footer from '@components/Footer.astro'
import siteConfig from '../site.config'

interface Props {
  title?: string
  description?: string
  tags?: string[]
  author?: string
}

const { title, description, tags, author } = Astro.props
const pageUrl = new URL(Astro.url.pathname, Astro.site).href.replace(/\/$/, '')
const pageType = Astro.url.pathname.startsWith('/posts') ? 'article' : 'website'
const pageTitle = title ? `${title} - ${siteConfig.title}` : siteConfig.title
const pageDescription = description || siteConfig.description
const pageAuthor = author || siteConfig.author
const pageImage =
  pageType === 'article'
    ? Astro.url.origin +
      Astro.url.pathname.replace(/\/posts\//, '/social-cards/') +
      '.png'
    : `${Astro.url.origin}/social-cards/__default.png`
const pageKeywords = [
  ...new Set(siteConfig.tags.concat(tags || []).map((word) => word.toLowerCase())),
].join(', ')
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="generator" content={Astro.generator} />
    <meta name="title" content={pageTitle} />
    <meta name="description" content={pageDescription} />
    <meta name="author" content={pageAuthor} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:url" content={pageUrl} />
    <meta property="og:type" content={pageType} />
    {pageImage && <meta property="og:image" content={pageImage} />}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    {pageImage && <meta name="twitter:image" content={pageImage} />}
    <meta name="keywords" content={pageKeywords} />
    <link rel="canonical" href={pageUrl} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link
      rel="alternate"
      type="application/rss+xml"
      title={siteConfig.title}
      href={new URL('rss.xml', Astro.site)}
    />
    <title>{pageTitle}</title>
    <script is:inline>
      ;(function () {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.setAttribute('data-theme', 'dark')
        }
      })()
    </script>
  </head>
  <body class="bg-background text-foreground">
    <div class="flex flex-col max-w-4xl min-h-screen mx-auto px-6 py-12">
      <Header />
      <main class="flex-1">
        <slot />
      </main>
      <Footer />
    </div>
  </body>
</html>
